package castboard.view;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JMenuBar;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.Box;
import javax.swing.JToolBar;
import javax.swing.JLabel;
import javax.swing.JScrollPane;
import javax.swing.ImageIcon;
import java.awt.CardLayout;
import java.awt.BorderLayout;
import java.awt.event.KeyEvent;
import javax.swing.event.MenuListener;
import javax.swing.event.MenuEvent;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class MasterFrame extends JFrame
{
	private JMenuBar mnbActions;
	private JToolBar tlbNavigation;
	private JPanel pnlBody;
	private JPanel pnlWrapper;
	private JScrollPane sclBody;
	private LoginPopUp login;
	private boolean isConnected;

	public MasterFrame ()
	{
		super("CastBoard");

		createMnbActions();
		createTlbNavigation();
		createPnlBody();
		createPnlWrapper();
		
		isConnected = false;

		ImageIcon icon = new ImageIcon("castboard/res/icons/" + 
														"ico_128_cb.png");
		this.setIconImage(icon.getImage());
		this.setSize(800, 600);
		this.add(pnlWrapper);
		
		this.setVisible(true);
		
		login= new LoginPopUp(this);
		login.display();
	}

	private void createMnbActions ()
	{
		JMenu mnEntry = new JMenu("Ingreso");
		JMenu mnSearch = new JMenu("Búsqueda");
		JMenu mnBin = new JMenu("Papelera");
		JMenu mnLog = new JMenu("Iniciar Sesión");
		JMenuItem mniTalentEntry = new JMenuItem("Talento");
		JMenuItem mniProjectEntry = new JMenuItem("Proyecto");
		JMenuItem mniTalentSearch = new JMenuItem("Talento");
		JMenuItem mniProjectSearch = new JMenuItem("Proyecto");

		mnbActions = new JMenuBar();
		
		mnEntry.setToolTipText("Menú de ingreso");
		mnSearch.setToolTipText("Menú de búsqueda");
		mnBin.setToolTipText("Papelera de eliminados");
		mnLog.setToolTipText("Inicio de sesión");
		mniTalentEntry.setToolTipText("Ingreso de talento");
		mniProjectEntry.setToolTipText("Ingreso de proyecto");
		mniTalentSearch.setToolTipText("Búsqueda de talento");
		mniProjectSearch.setToolTipText("Búsqueda de proyecto");
		
		mnBin.addMenuListener(new MenuListener()
		{
			public void menuSelected (MenuEvent e)
			{
				//TODO call bin window
			}
			public void menuDeselected (MenuEvent e)
			public void menuCanceled (MenuEvent e) {}
		});
		mnLog.addMenuListener(new MenuListener()
		{
			public void menuSelected (MenuEvent e)
			{
				if (isConnected)
					logOut();
				else
					login.display();
			}
			public void menuDeselected (MenuEvent e)
			public void menuCanceled (MenuEvent e) {}
		});
		mniTalentEntry.addActionListener(new ActionListener()
		{
			public void actionPerformed (ActionEvent e)
			{
				//TODO call talent entry window
			}
		});
		mniProjectEntry.addActionListener(new ActionListener()
		{
			public void actionPerformed (ActionEvent e)
			{
				//TODO call project entry window
			}
		});
		mniTalentSearch.addActionListener(new ActionListener()
		{
			public void actionPerformed (ActionEvent e)
			{
				//TODO call talent search window
			}
		});
		mniProjectSearch.addActionListener(new ActionListener()
		{
			public void actionPerformed (ActionEvent e)
			{
				//TODO call project search window
			}
		});
		//TODO: set mnemonics and listeners

		mnEntry.add(mniTalentEntry);
		mnEntry.add(mniProjectEntry);
		mnSearch.add(mniTalentSearch);
		mnSearch.add(mniProjectSearch);
		
		mnbActions.add(mnEntry);
		mnbActions.add(mnSearch);
		mnbActions.add(mnBin);
		mnbActions.add(Box.createHorizontalGlue());
		mnbActions.add(mnLog);
	}
	private void createTlbNavigation()
	{
		tlbNavigation = new JToolBar();
		tlbNavigation.setFloatable(false);
		
		addLblLink("");
	}
	private void createPnlBody()
	{
		pnlBody = new JPanel();
		pnlBody.setLayout(new CardLayout());
		
		sclBody = new JScrollPane(pnlBody);
	}
	private void createPnlWrapper()
	{
		pnlWrapper = new JPanel();
		pnlWrapper.setLayout(new BorderLayout());
		
		pnlWrapper.add(mnbActions, BorderLayout.PAGE_START);
		pnlWrapper.add(sclBody, BorderLayout.CENTER);
		pnlWrapper.add(tlbNavigation, BorderLayout.PAGE_END);
	}
	
	public void addLblLink(String link)
	{
		JLabel lblLink = new JLabel(" \u25B8" + link);
		
		//TODO: add listener and some link stile
		
		tlbNavigation.add(lblLink);
	}
	
	public void logIn()
	{
		isConnected = true;
		mnbActions.getMenu(4).setText("Cerrar sesión");
		displayFront();
	}
	public void logOut()
	{
		isConnected = false;
		mnbActions.getMenu(4).setText("Iniciar sesión");
		displayBlank();
	}
	
	public void displayFront ()
	{
		if (isConnected)
			pnlBody.add(new JLabel("" + isConnected), "conexion");
	}
	public void displayBlank()
	{
		
	}
	
	public void setIsConnected(boolean isConnected)
	{
		this.isConnected = isConnected;
	}
}